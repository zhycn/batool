---
import HomeLayout from "../layouts/HomeLayout.astro";
import EmptyState from "../components/EmptyState.astro";
import Skeleton from "../components/Skeleton.astro";
import LoadingContainer from "../components/LoadingContainer.astro";
import type { Tool } from "../types/tool";
import { UI_CONFIG, SEARCH_CONFIG } from "../types/settings";

// 加载工具数据
const toolsData = await import("../../public/tools.json");
const tools: Tool[] = toolsData.default as Tool[];

// 获取所有分类并统计
const categories = tools.reduce(
  (acc, tool) => {
    const cat = tool.category || "未分类";
    acc[cat] = (acc[cat] || 0) + 1;
    return acc;
  },
  {} as Record<string, number>,
);

// 按工具数量排序分类
const categoryList = Object.entries(categories).sort((a, b) => b[1] - a[1]);
---

<HomeLayout totalCount={tools.length} categoryList={categoryList}>
  <!-- 主内容区 -->
  <div class="w-full grow py-6">
    <!-- 工具列表 -->
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <EmptyState />
      <Skeleton />
      <!-- 工具列表 -->
      <div
        id="tools-list"
        class="grid grid-cols-1 gap-3 sm:gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"
      >
        <!-- 由 JS 动态渲染 -->
      </div>
      <LoadingContainer />
    </div>

    <!-- 服务端数据传递到客户端 -->
    <script
      define:vars={{ tools, uiConfig: UI_CONFIG, searchConfig: SEARCH_CONFIG }}
    >
      window.__TOOLS__ = tools;
      window.__UI_CONFIG__ = uiConfig;
      window.__SEARCH_CONFIG__ = searchConfig;
    </script>

    <!-- 客户端脚本 -->
    <script type="module" src="/src/scripts/main.ts"></script>
  </div>
</HomeLayout>
